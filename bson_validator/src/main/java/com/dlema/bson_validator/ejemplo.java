package com.dlema.bson_validator;

import org.bson.BasicBSONDecoder;
import org.bson.BasicBSONObject;
import org.bson.BsonSerializationException;

public class ejemplo {
	
	private final static String TO_TEST = "ED00057400737B20227061736F22203A20227061736F31222C20226E756D65726F536F6C696374756422203A20225644495F323031395F3234313131222C20226964496E666F5472616E73616363696F6E22203A2022376362626666393539316364323664646430643964653132333461616333643022207D";
	// x'037001000003636162656365726100E40000000265737461646F5472616E73616363696F6E000100000000027061736F46756E63696F6E616C00060000007061736F3200026E756D65726F536F6C696369747564000F0000005644495F323031395F32343531380004657874656E73696F6E46756E63696F6E616C00760000000330004E000000026C6C617665001200000053454355524954595F434F4E53554D4552000276616C6F720021000000383438626639623961303566626337343563326439656331303532653431623500000331001D000000026C6C6176650001000000000276616C6F7200010000000000000004646F63756D656E746F7300710000000330006900000002696453756270726F647563746F0003000000313400027469706F446F63756D656E746F00040000003132330002646F63756D656E746F000100000000026465736372697063696F6E0016000000556E6966696361646F4C69627265496E762E70646600000000'
	// x'ACED00057400737B20227061736F22203A20227061736F31222C20226E756D65726F536F6C696374756422203A20225644495F323031395F3234313131222C20226964496E666F5472616E73616363696F6E22203A2022376362626666393539316364323664646430643964653132333461616333643022207D'
	
	public static void main (String[] args) {
		BasicBSONDecoder decoder = new BasicBSONDecoder();
		
		System.out.println("Tamaño del bson: " + TO_TEST.length() / 2);
		byte[] val = new byte[TO_TEST.length() / 2];
		
		for (int i = 0; i < val.length; i++) {
			   int index = i * 2;
			   int j = Integer.parseInt(TO_TEST.substring(index, index + 2), 16);
			   val[i] = (byte) j;
			}
		
		for (byte b : val) {
			String st = String. format("%02X", b);
			System.out.print(st);
			}
		System.out.println(val);
		
		try {
			BasicBSONObject bsonObject = (BasicBSONObject)decoder.readObject(val);
			System.out.println(bsonObject);
		} catch (BsonSerializationException e) {
			System.out.println("este registro no corresponde a un BSON o está mal conformado");
			e.printStackTrace();
		}
		
	}

}
